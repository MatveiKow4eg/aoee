# TZ: AOE Estonia ‚Äî ¬´–ö–∞—Ä—Ç–∞ —Ü–∞—Ä—Å—Ç–≤–∞¬ª (–≤–µ–±)

–¶–µ–ª—å –¥–æ–∫—É–º–µ–Ω—Ç–∞: –¥–∞—Ç—å –ò–ò‚Äë–∞–≥–µ–Ω—Ç—É (—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É) –ø–æ–ª–Ω–æ–µ –¢–ó –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤–µ–±‚Äë–∫–∞—Ä—Ç—ã –∫–æ–º—å—é–Ω–∏—Ç–∏ AOE Estonia —Å –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º/–∑—É–º–æ–º, –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º –∏–≥—Ä–æ–∫–æ–≤ –ø–æ —Å—Ç—Ä–æ–µ–Ω–∏—è–º (—Ç–∏—Ä‚Äë–ª–∏—Å—Ç), –æ–±—â–∏–º –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –¥–ª—è –≤—Å–µ—Ö, —Ä–æ–ª—è–º–∏ –∏ –ª–æ–≥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π.

---

## 0) –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è
–ù—É–∂–µ–Ω –≤–µ–±‚Äë—Å–∞–π—Ç (—Å—Å—ã–ª–∫–∞), –≥–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è **–±–æ–ª—å—à–∞—è ‚Äú—Ñ—ç–Ω—Ç–µ–∑–∏‚Äë–∫–∞—Ä—Ç–∞‚Äù** –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–∞. –ù–∞ –∫–∞—Ä—Ç–µ —Ä–∞–∑–º–µ—â–µ–Ω—ã **6 —Å—Ç—Ä–æ–µ–Ω–∏–π** (–∑–æ–Ω—ã), —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∏—Ä‚Äë–ª–∏—Å—Ç—É:

1. **–ó–∞–º–∫–∏** üè∞ ‚Äî –ö–æ—Ä–æ–ª—å –ö–∏—Ä–∏–ª–ª, –ì–µ—Ä—Ü–æ–≥ –°—Ç–∞—Å, –ì—Ä–∞—Ñ –ú–∞—Ç–≤–µ–π, –ë–∞—Ä–æ–Ω‚Äë–ô–æ—ç–ª—å
2. **–ö—Ä–µ–ø–æ—Å—Ç–∏** üõï ‚Äî –ê–Ω–¥—Ä–µ–π, –í–∞–ª—è, –î—ç–Ω–µ—Ä, –ë–æ—Ä–∏—Å
3. **–î–æ–Ω–∂–æ–Ω—ã** üèõÔ∏è ‚Äî –°—Ç–µ–ø–∞–Ω, –û–ª–µ–≥, –ù–∏–∫–∏—Ç–∞ –ú–æ–ª., –°–∞–π–º–æ–Ω
4. **–ë–∞—à–Ω–∏** üõñ ‚Äî –í–∞–Ω—è, –†—ç—Ç, –ï–ª—è, –ì–∞–≤—Ä–∏–∏–ª
5. **–†—è–¥–Ω–∞—è —Ö–∞–ª—É–ø–∞** üè° ‚Äî –õ—ë—à–∞, –°–∞—à–∞ –ü–æ–ø–æ–≤—ã, –¢–∏–º—É—Ä
6. **–•–∞–ª—É–ø–∞** üèöÔ∏è ‚Äî –ê—Ä–∏–Ω–∞, –ù–∏–∫–∏—Ç–∞ –ú—ë–ª—å–¥, –ö–∏—Ä–∏–ª–ª –ö—Ä, –ê—Ä—Ç—ë–º –°–æ–≤–∞, –ï–≥–æ—Ä –§., –ò–ª—å—è

–ò–≥—Ä–æ–∫–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã **–∏–∫–æ–Ω–∫–∞–º–∏/–∞–≤–∞—Ç–∞—Ä–∫–∞–º–∏** —Å –ø–æ–¥–ø–∏—Å—å—é. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
- –¥–≤–∏–≥–∞—Ç—å –∫–∞—Ä—Ç—É (–ø–∞–Ω)
- –ø—Ä–∏–±–ª–∏–∂–∞—Ç—å/–æ—Ç–¥–∞–ª—è—Ç—å (–∑—É–º)
- –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∫–∞—Ä—Ç–µ
- –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –∏–≥—Ä–æ–∫–∞ –≤ –∑–æ–Ω—É –¥—Ä—É–≥–æ–≥–æ —Å—Ç—Ä–æ–µ–Ω–∏—è –º–µ–Ω—è–µ—Ç—Å—è –µ–≥–æ —Ç–∏—Ä

–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞—Ä—Ç—ã –¥–æ–ª–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å:
- **–ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** (localStorage) –¥–ª—è —á–µ—Ä–Ω–æ–≤–∏–∫–∞
- **–æ–±—â—É—é –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—É—é —Ä–∞—Å–∫–ª–∞–¥–∫—É** –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (Supabase)
- **–ø—Ä–∞–≤–∞** (–∫—Ç–æ –º–æ–∂–µ—Ç –¥–≤–∏–≥–∞—Ç—å/–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å)
- **–∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π** (–ª–æ–≥)

---

## 1) –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1.1 –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã
- –í–µ–± (desktop –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- Mobile –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–ø–∞–Ω/–∑—É–º –¥–≤—É–º—è –ø–∞–ª—å—Ü–∞–º–∏), –Ω–æ –Ω–∞ MVP –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –≤—Ç–æ—Ä–∏—á–Ω—ã–º

### 1.2 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ü–ª–∞–≤–Ω—ã–π pan/zoom (60 FPS –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –ü–ö)
- 6 —Å—Ç—Ä–æ–µ–Ω–∏–π + 20‚Äì30 –∏–≥—Ä–æ–∫–æ–≤ –±–µ–∑ –ª–∞–≥–æ–≤
- –ö–∞—Ä—Ç–∞‚Äë—Ç–µ–∫—Å—Ç—É—Ä–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ (–≤ –∏–¥–µ–∞–ª–µ < 5‚Äì8MB –¥–ª—è –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏). –î–ª—è –±–æ–ª—å—à–∏—Ö –∫–∞—Ä—Ç ‚Äî —Ç–∞–π–ª–∏–Ω–≥.

### 1.3 –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ —Å—Å—ã–ª–∫–µ –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- –ë–∞–∑–æ–≤–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: Chrome/Edge/Safari –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –≤–µ—Ä—Å–∏–π

### 1.4 –°—Ç–µ–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)
- Frontend: **Next.js** (Vercel) –∏–ª–∏ –¥—Ä—É–≥–æ–π React‚Äë—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- –†–µ–Ω–¥–µ—Ä —Å—Ü–µ–Ω—ã: **PixiJS (WebGL)**
- Pan/Zoom: **pixi-viewport**
- Backend/DB/Auth: **Supabase**

–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: PixiJS –¥–∞—ë—Ç ¬´–∏–≥—Ä–æ–≤—É—é¬ª —Å—Ü–µ–Ω—É –∏ –ø–ª–∞–≤–Ω–æ—Å—Ç—å; Supabase —É—Å–∫–æ—Ä—è–µ—Ç –æ–±—â–∏–π state + auth + RLS.

---

## 2) –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è

### 2.1 –°–ª–æ–∏
1) **UI‚Äë—Å–ª–æ–π (React)**
- –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å (–∫–Ω–æ–ø–∫–∏, —Ä–µ–∂–∏–º—ã)
- –ø—Ä–∞–≤—ã–π —Å–∞–π–¥–±–∞—Ä (–ª–µ–≥–µ–Ω–¥–∞, –ª–æ–≥, –ø–æ–∏—Å–∫)
- –º–æ–¥–∞–ª–∫–∏ (–≤—Ö–æ–¥, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ publish)

2) **–°—Ü–µ–Ω–∞ (PixiJS)**
- world container
- background map (sprite –∏–ª–∏ tilemap)
- buildings layer (—Å–ø—Ä–∞–π—Ç—ã —Å—Ç—Ä–æ–µ–Ω–∏–π + –∑–æ–Ω—ã)
- players layer (draggable —Ç–æ–∫–µ–Ω—ã)
- labels layer (–ø–æ–¥–ø–∏—Å–∏/—Ç–∏—Ç—É–ª—ã)

3) **State management**
- –ª–æ–∫–∞–ª—å–Ω—ã–π: localStorage (draft)
- —É–¥–∞–ª—ë–Ω–Ω—ã–π: Supabase (published)

### 2.2 –†–µ–∂–∏–º—ã
- **Viewer**: –≤–∏–¥–∏—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—É—é –∫–∞—Ä—Ç—É
- **Editor**: –º–æ–∂–µ—Ç –¥–≤–∏–≥–∞—Ç—å –≤ —á–µ—Ä–Ω–æ–≤–∏–∫–µ (draft)
- **Admin/King**: –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å (publish) –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–æ–ª—è–º–∏

---

## 3) –î–∞–Ω–Ω—ã–µ –∏ –º–æ–¥–µ–ª–∏

### 3.1 –°—É—â–Ω–æ—Å—Ç–∏
#### Player
- id: uuid
- name: string
- avatar_url: string | null
- default_tier: TierKey
- title: string | null (–Ω–∞–ø—Ä–∏–º–µ—Ä ¬´–ì–µ—Ä—Ü–æ–≥¬ª)

#### Tier/Building (–∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã)
TierKey: one of
- "–ó–∞–º–∫–∏" | "–ö—Ä–µ–ø–æ—Å—Ç–∏" | "–î–æ–Ω–∂–æ–Ω—ã" | "–ë–∞—à–Ω–∏" | "–†—è–¥–Ω–∞—è —Ö–∞–ª—É–ø–∞" | "–•–∞–ª—É–ø–∞"

#### MapStatePayload (JSON)
–•—Ä–∞–Ω–∏—Ç —Ç–µ–∫—É—â—É—é —Ä–∞—Å–∫–ª–∞–¥–∫—É:
```json
{
  "world": {"w": 3000, "h": 1800, "mapTextureVersion": 1},
  "buildings": {
    "–ó–∞–º–∫–∏": {"x": 2100, "y": 260},
    "–ö—Ä–µ–ø–æ—Å—Ç–∏": {"x": 620, "y": 360},
    "–î–æ–Ω–∂–æ–Ω—ã": {"x": 2140, "y": 860},
    "–ë–∞—à–Ω–∏": {"x": 760, "y": 980},
    "–†—è–¥–Ω–∞—è —Ö–∞–ª—É–ø–∞": {"x": 1760, "y": 1420},
    "–•–∞–ª—É–ø–∞": {"x": 760, "y": 1500}
  },
  "players": {
    "<playerId>": {"x": 700, "y": 420, "tier": "–ö—Ä–µ–ø–æ—Å—Ç–∏"}
  }
}
```

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ø–æ–∑–∏—Ü–∏–∏ —Å—Ç—Ä–æ–µ–Ω–∏–π –æ–±—ã—á–Ω–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ (–∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã), –Ω–æ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏ –≤ –±—É–¥—É—â–µ–º.

---

## 4) –ë–î Supabase (—Ç–∞–±–ª–∏—Ü—ã + RLS)

### 4.1 –¢–∞–±–ª–∏—Ü–∞ `players`
–ü–æ–ª—è:
- id uuid pk default gen_random_uuid()
- name text not null unique
- avatar_url text null
- default_tier text not null
- title text null
- created_at timestamptz default now()

### 4.2 –¢–∞–±–ª–∏—Ü–∞ `profiles`
–ü–æ–ª—è:
- id uuid pk (—Ä–∞–≤–µ–Ω auth.users.id)
- display_name text
- role text not null default 'viewer'  // viewer | editor | admin | king
- created_at timestamptz default now()

### 4.3 –¢–∞–±–ª–∏—Ü–∞ `map_state`
–•—Ä–∞–Ω–∏—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏.
–ü–æ–ª—è:
- id uuid pk default gen_random_uuid()
- version int not null
- is_current bool not null default false
- payload jsonb not null
- published_at timestamptz default now()
- published_by uuid references profiles(id)

–ò–Ω–¥–µ–∫—Å:
- unique partial index on (is_current) where is_current = true

### 4.4 –¢–∞–±–ª–∏—Ü–∞ `draft_state` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ü–æ–ª—è:
- id uuid pk default gen_random_uuid()
- user_id uuid references profiles(id)
- payload jsonb not null
- updated_at timestamptz default now()

### 4.5 –¢–∞–±–ª–∏—Ü–∞ `audit_log`
–ü–æ–ª—è:
- id uuid pk default gen_random_uuid()
- at timestamptz default now()
- actor_id uuid references profiles(id)
- action text not null  // MOVE_PLAYER, PUBLISH, RESET, etc.
- before jsonb
- after jsonb

### 4.6 RLS (–ø—Ä–∞–≤–∏–ª–∞)
- `players`: read –≤—Å–µ–º; write —Ç–æ–ª—å–∫–æ admin/king
- `profiles`: read –≤—Å–µ–º (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ); write —Ç–æ–ª—å–∫–æ admin/king (–∏–ª–∏ self‚Äëwrite –¥–ª—è display_name)
- `map_state`: read –≤—Å–µ–º; insert —Ç–æ–ª—å–∫–æ admin/king; update –∑–∞–ø—Ä–µ—â—ë–Ω (–≤–µ—Ä—Å–∏–∏ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–µ)
- `draft_state`: read/write —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É (user_id = auth.uid()) –∏ admin/king
- `audit_log`: read –≤—Å–µ–º; insert —Ç–æ–ª—å–∫–æ admin/king (–∏–ª–∏ editor, –µ—Å–ª–∏ —Ö–æ—Ç–∏–º –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –¥–µ–π—Å—Ç–≤–∏—è)

---

## 5) –®–∞–≥ 1 ‚Äî MVP (–ª–æ–∫–∞–ª—å–Ω–æ) ‚úÖ

### 5.1 –¶–µ–ª—å
–°–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—á—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –±–µ–∑ –±—ç–∫–∞:
- –∫–∞—Ä—Ç–∞‚Äë—Ç–µ–∫—Å—Ç—É—Ä–∞
- pan/zoom
- 6 —Å—Ç—Ä–æ–µ–Ω–∏–π
- –∏–≥—Ä–æ–∫–∏ draggable
- localStorage save/load

### 5.2 –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å—Ü–µ–Ω—ã
1) **World —Ä–∞–∑–º–µ—Ä**
- –±–∞–∑–æ–≤–æ: 3000√ó1800 (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)

2) **Background**
- –∑–∞–≥—Ä—É–∑–∫–∞ 1 –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∫–∞—Ä—Ç—ã (PNG/JPG)
- fallback: procedural (–Ω–∞ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

3) **Buildings**
- 6 –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
- —É –∫–∞–∂–¥–æ–≥–æ –µ—Å—Ç—å **drop‚Äëzone** (–ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫/—Ñ–æ—Ä–º–∞)

4) **Players**
- —Ç–æ–∫–µ–Ω: –∞–≤–∞—Ç–∞—Ä (–∏–ª–∏ –∑–∞–≥–ª—É—à–∫–∞) + –ø–æ–¥–ø–∏—Å—å
- drag:
  - –ø—Ä–∏ pointerdown —Ç–æ–∫–µ–Ω –±–µ—Ä—ë—Ç—Å—è
  - viewport drag –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è
  - –ø—Ä–∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è, –ø–æ–ø–∞–ª –ª–∏ –≤ drop‚Äëzone
  - –µ—Å–ª–∏ –ø–æ–ø–∞–ª ‚Äî –º–µ–Ω—è–µ—Ç—Å—è tier –∏ –¥–µ–ª–∞–µ—Ç—Å—è snap –≤–Ω—É—Ç—Ä–∏ –∑–æ–Ω—ã (—Ä–∞—Å–∫–ª–∞–¥–∫–∞ —Å–µ—Ç–∫–æ–π)

5) **localStorage**
–ö–ª—é—á `aoe_estonia_map_draft_v1`
- —Å–æ—Ö—Ä–∞–Ω—è—Ç—å payload (players positions + tier)
- –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
  - –µ—Å–ª–∏ –µ—Å—Ç—å localStorage draft ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å
  - –∏–Ω–∞—á–µ ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∏—Ö default_tier

### 5.3 UI MVP
- –∫–Ω–æ–ø–∫–∏: Center, Save, Reset
- –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–µ–π (—Ç–∏—Ç—É–ª—ã/–∏–º–µ–Ω–∞)
- –ø–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –Ω–∞ MVP)

### 5.4 Definition of Done
- –õ—é–±–æ–π –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –≤–∏–¥–∏—Ç –∫–∞—Ä—Ç—É
- –ú–æ–∂–Ω–æ –¥–≤–∏–≥–∞—Ç—å –∫–∞—Ä—Ç—É –∏ –∑—É–º–∏—Ç—å
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å –∏–≥—Ä–æ–∫–æ–≤
- Save/Reset —Ä–∞–±–æ—Ç–∞—é—Ç

---

## 6) –®–∞–≥ 2 ‚Äî –û–±—â–∏–π state –¥–ª—è –≤—Å–µ—Ö (Supabase) üåê

### 6.1 –¶–µ–ª—å
–°–¥–µ–ª–∞—Ç—å "–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é" –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—É—é –∫–∞—Ä—Ç—É:
- viewers –≤–∏–¥—è—Ç published
- editors –ø—Ä–∞–≤—è—Ç draft
- admin/king –ø—É–±–ª–∏–∫—É—é—Ç

### 6.2 –ü–æ—Ç–æ–∫–∏
#### Viewer Flow
- –ø—Ä–∏ –≤—Ö–æ–¥–µ: `SELECT * FROM map_state WHERE is_current=true LIMIT 1`
- –ø—Ä–∏–º–µ–Ω–∏—Ç—å payload –∫ —Å—Ü–µ–Ω–µ

#### Editor Flow
- –µ—Å–ª–∏ —Ä–æ–ª—å editor/admin/king:
  - –∑–∞–≥—Ä—É–∂–∞—Ç—å draft_state (–µ—Å–ª–∏ –µ—Å—Ç—å)
  - –∏–Ω–∞—á–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å published –≤ draft
  - –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏: debounce save draft_state

#### Publish Flow (admin/king)
- –∫–Ω–æ–ø–∫–∞ Publish
- —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π `map_state`:
  - version = previous.version + 1
  - payload = —Ç–µ–∫—É—â–∏–π draft
  - is_current = true
  - published_by = auth.uid
- –ø—Ä–µ–¥—ã–¥—É—â–∏–π current set is_current=false (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ)

### 6.3 –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã
MVP‚Äë—Å—Ç—Ä–∞—Ç–µ–≥–∏—è:
- —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –æ–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫ (–∞–¥–º–∏–Ω) –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) lock: `draft_lock` –ø–æ user_id

### 6.4 Definition of Done
- –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—É—é –∫–∞—Ä—Ç—É
- –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π editor –º–æ–∂–µ—Ç –¥–≤–∏–≥–∞—Ç—å –∏–≥—Ä–æ–∫–æ–≤ (—á–µ—Ä–Ω–æ–≤–∏–∫)
- Admin/King –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å

---

## 7) –®–∞–≥ 3 ‚Äî –ö–∞—á–µ—Å—Ç–≤–æ –≤–∏–∑—É–∞–ª–∞ üé®

### 7.1 –¶–µ–ª—å
–î–æ–≤–µ—Å—Ç–∏ –¥–æ ¬´—Ñ—ç–Ω—Ç–µ–∑–∏‚Äë–∫–∞—Ä—Ç—ã¬ª:
- –∫—Ä–∞—Å–∏–≤–∞—è –ø–æ–¥–ª–æ–∂–∫–∞
- –µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å –∑–¥–∞–Ω–∏–π
- –∞–≤–∞—Ç–∞—Ä—ã
- —á–∏—Ç–∞–µ–º—ã–µ –ø–æ–¥–ø–∏—Å–∏

### 7.2 –ö–∞—Ä—Ç–∞‚Äë—Ç–µ–∫—Å—Ç—É—Ä–∞
–í–∞—Ä–∏–∞–Ω—Ç A (–ø—Ä–æ—Å—Ç–æ–µ): –æ–¥–Ω–∞ PNG 4000√ó2400, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è.
–í–∞—Ä–∏–∞–Ω—Ç B (–ª—É—á—à–µ–µ): —Ç–∞–π–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä 512√ó512) + –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ –∑—É–º—É/–æ–±–ª–∞—Å—Ç–∏.

### 7.3 –ó–¥–∞–Ω–∏—è
- –Ω–∞–±–æ—Ä –∏–∫–æ–Ω–æ–∫/—Å–ø—Ä–∞–π—Ç–æ–≤ (PNG) –ø–æ–¥ –∫–∞–∂–¥—ã–π tier
- –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∑–æ–Ω—ã –ø—Ä–∏ hover —Ç–æ–∫–µ–Ω–∞
- –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (—Ñ–ª–∞–≥–∏, –¥–æ—Ä–æ–∂–∫–∏, –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–µ–≥–∏–æ–Ω–æ–≤)

### 7.4 –ò–≥—Ä–æ–∫–∏
- –∞–≤–∞—Ç–∞—Ä –≤ –∫—Ä—É–≥–µ
- —Ä–∞–º–∫–∞ –ø–æ tier (—Ü–≤–µ—Ç/—Ñ–æ—Ä–º–∞)
- –ø—Ä–∏ –∑—É–º–µ:
  - –±–ª–∏–∑–∫–æ: –∏–º—è
  - –¥–∞–ª–µ–∫–æ: —Ç–æ–ª—å–∫–æ —Ç–æ—á–∫–∞/–∏–∫–æ–Ω–∫–∞

### 7.5 UX —É–ª—É—á—à–µ–Ω–∏—è
- –º–∏–Ω–∏–∫–∞—Ä—Ç–∞
- –ø–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–∞ (—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–º–µ—Ä—ã)
- –∫–Ω–æ–ø–∫–∏ –∑—É–º–∞

---

## 8) –®–∞–≥ 4 ‚Äî –ö–æ–º—å—é–Ω–∏—Ç–∏‚Äë—Ñ–∏—á–∏ ‚öîÔ∏è

### 8.1 –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (audit)
–°–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
- MOVE_PLAYER (–∫—Ç–æ, –∫–æ–≥–æ, –æ—Ç–∫—É–¥–∞, –∫—É–¥–∞)
- PUBLISH (–≤–µ—Ä—Å–∏—è)

UI:
- –ø–∞–Ω–µ–ª—å ¬´–õ–µ–Ω—Ç–∞¬ª —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ N —Å–æ–±—ã—Ç–∏—è–º–∏

### 8.2 –ü—Ä–∞–≤–∞
–†–æ–ª–∏:
- viewer: read
- editor: draft write
- admin: publish + —É–ø—Ä–∞–≤–ª—è–µ—Ç players
- king: –≤—Å—ë

### 8.3 –°–æ–±—ã—Ç–∏—è –Ω–µ–¥–µ–ª–∏ / –≤–æ–π–Ω—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- —Ç–∞–±–ª–∏—Ü–∞ `events`
- –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∫–æ–Ω–æ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ
- –±–∞–Ω–Ω–µ—Ä –≤ UI

---

## 9) UI/UX —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (–ø–æ–¥—Ä–æ–±–Ω–æ)

### 9.1 –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å
- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- Center
- Save (—á–µ—Ä–Ω–æ–≤–∏–∫)
- Publish (—Ç–æ–ª—å–∫–æ admin/king)
- Reset draft
- –°–µ–ª–µ–∫—Ç–æ—Ä –ø–æ–¥–ø–∏—Å–µ–π (—Ç–∏—Ç—É–ª/–∏–º—è)

### 9.2 –ü—Ä–∞–≤—ã–π —Å–∞–π–¥–±–∞—Ä
–í–∫–ª–∞–¥–∫–∏:
- –õ–µ–≥–µ–Ω–¥–∞ (—Ç–∏—Ä—ã, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤)
- –ò–≥—Ä–æ–∫–∏ (–ø–æ–∏—Å–∫, —Å–ø–∏—Å–æ–∫)
- –õ–µ–Ω—Ç–∞ (audit)

### 9.3 –ö–∞—Ä—Ç–æ—á–∫–∞ –∏–≥—Ä–æ–∫–∞ (popover)
–ü–æ –∫–ª–∏–∫—É –Ω–∞ —Ç–æ–∫–µ–Ω:
- –∏–º—è
- —Ç–µ–∫—É—â–∏–π tier
- –∏—Å—Ö–æ–¥–Ω—ã–π tier
- –∞–≤–∞—Ç–∞—Ä
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∑–∞–º–µ—Ç–∫–∏

---

## 10) –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∞—Å—Å–µ—Ç–∞–º

### 10.1 –ö–∞—Ä—Ç–∞
- PNG/JPG, –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ 3000‚Äì5000 px –ø–æ —à–∏—Ä–∏–Ω–µ
- –í–µ—Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å

### 10.2 –ó–¥–∞–Ω–∏—è
- 6 PNG —Å–ø—Ä–∞–π—Ç–æ–≤ –≤ –µ–¥–∏–Ω–æ–º —Å—Ç–∏–ª–µ

### 10.3 –ê–≤–∞—Ç–∞—Ä—ã
- URL –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏
- fallback –∑–∞–≥–ª—É—à–∫–∞

---

## 11) –¢–µ—Å—Ç‚Äë–∫–µ–π—Å—ã

### 11.1 –ë–∞–∑–æ–≤—ã–µ
- –û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç: –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å
- Pan —Ä–∞–±–æ—Ç–∞–µ—Ç
- Zoom —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü–µ—Ä–µ—Ç–∞—â–∏—Ç—å –∏–≥—Ä–æ–∫–∞ –≤ –¥—Ä—É–≥—É—é –∑–æ–Ω—É ‚Üí tier –ø–æ–º–µ–Ω—è–ª—Å—è
- Save/Reload ‚Üí –ø–æ–∑–∏—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

### 11.2 Supabase
- Viewer –≤–∏–¥–∏—Ç published
- Editor —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç draft
- Admin –ø—É–±–ª–∏–∫—É–µ—Ç ‚Üí viewer –≤–∏–¥–∏—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é

### 11.3 –†–æ–ª–∏
- viewer –Ω–µ –≤–∏–¥–∏—Ç –∫–Ω–æ–ø–∫—É Publish
- editor –Ω–µ –º–æ–∂–µ—Ç publish
- admin –º–æ–∂–µ—Ç publish

---

## 12) –ü–æ—Å—Ç–∞–≤–∫–∏ (deliverables)

1) –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –≤–µ–±‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
2) –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ ENV (Supabase URL/KEY)
3) SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü
4) –ù–∞–±–æ—Ä –∞—Å—Å–µ—Ç–æ–≤ (–∫–∞—Ä—Ç–∞ + –∑–¥–∞–Ω–∏—è) –∏–ª–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–∏—Ö

---

## 13) –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –ù–∞ MVP –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π –≤–∏–∑—É–∞–ª (procedural), –Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–∑–≤–æ–ª—è—Ç—å –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–µ–∫—Å—Ç—É—Ä—ã.
- –î–ª—è –æ–±—â–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ Discord OAuth (–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –¥–ª—è –∫–æ–º—å—é–Ω–∏—Ç–∏), –Ω–æ –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Å magic link.

